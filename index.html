<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ºå­æ‰ä¸‹æ¥ - ååº”é€Ÿåº¦æµ‹è¯•æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Arial Rounded MT Bold', sans-serif;
        }
        
        body {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FF);
            overflow: hidden;
            position: relative;
        }
        
        /* ä¸»æ¸¸æˆåŒºåŸŸ */
        .game-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            z-index: 2;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2), 
                        inset 0 -5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-align: center;
            padding: 30px;
            border: 8px solid #FF6B6B;
            animation: container-pulse 3s infinite alternate;
        }
        
        @keyframes container-pulse {
            0% { border-color: #FF6B6B; }
            100% { border-color: #4ECDC4; }
        }
        
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 3rem;
            background: linear-gradient(90deg, #FF6B6B, #4ECDC4, #45B7D1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }
        
        .description {
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }
        
        .game-area {
            position: relative;
            height: 500px;
            background: linear-gradient(to bottom, #E8F4F8, #C5E1F2);
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 5px solid #4ECDC4;
            cursor: pointer;
            display: flex;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .ruler {
            position: absolute;
            width: 80px;
            height: 350px;
            background: linear-gradient(to bottom, #FF9E7D, #FF6B6B);
            border-radius: 10px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2), 
                        inset 0 -5px 10px rgba(0, 0, 0, 0.1),
                        inset 0 5px 10px rgba(255, 255, 255, 0.5);
            top: -370px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            z-index: 10;
            transition: top 0.1s linear !important;
            border: 3px solid #FF8E53;
        }
        
        .ruler-mark {
            width: 100%;
            height: 2px;
            background: #fff;
        }
        
        .ruler-mark.long {
            height: 4px;
            background: #FFD166;
        }
        
        .ruler-number {
            color: white;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 5px;
            border-radius: 5px;
        }
        
        .hand {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            background: linear-gradient(to right, #4ECDC4, #45B7D1);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 5;
            font-size: 1.4rem;
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.1);
            border-top: 3px solid #2CA58D;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 30px;
            background: linear-gradient(to bottom, #FFD166, #FFB347);
            color: #8A4F0E;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            border: 3px solid #FF9F1C;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        .result {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 20px 0;
            color: #333;
            min-height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* å³ä¾§ä¿¡æ¯åŒºåŸŸ */
        .info-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-left: 5px solid #FF6B6B;
            overflow-y: auto;
            max-height: 100vh;
        }
        
        .score-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(to right, #A8E6CF, #88D3CE);
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #45B7D1;
        }
        
        .score-item {
            text-align: center;
        }
        
        .score-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #FF6B6B;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .score-label {
            font-size: 1.1rem;
            color: #2A617D;
            font-weight: bold;
        }
        
        .history-container {
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(to right, #D4A5A5, #C89595);
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #B76E79;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .history-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #5D4037;
            text-align: center;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .history-item {
            background: white;
            padding: 12px 15px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        
        .history-item.good {
            background: #C5E1A5;
            color: #33691E;
            border: 2px solid #7CB342;
        }
        
        .history-item.average {
            background: #FFF59D;
            color: #F57F17;
            border: 2px solid #FFD54F;
        }
        
        .history-item.poor {
            background: #EF9A9A;
            color: #B71C1C;
            border: 2px solid #E57373;
        }
        
        .history-time {
            font-size: 1.1rem;
        }
        
        .history-length {
            font-size: 1rem;
            background: rgba(0,0,0,0.1);
            padding: 4px 8px;
            border-radius: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #B76E79;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5D4037;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #5D4037;
            font-weight: bold;
        }
        
        .pulse {
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .next-instruction {
            margin-top: 15px;
            color: #FF6B6B;
            font-weight: bold;
            font-size: 1.3rem;
            background: rgba(255, 255, 255, 0.7);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .click-indicator {
            position: absolute;
            width: 100%;
            height: 4px;
            background: #4ECDC4;
            z-index: 15;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 0 10px #4ECDC4;
        }
        
        .click-indicator.show {
            opacity: 1;
        }
        
        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 3;
            font-size: 1.8rem;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FF6B6B;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            body {
                flex-direction: column;
            }
            
            .info-section {
                border-left: none;
                border-top: 5px solid #FF6B6B;
                max-height: 50vh;
            }
        }
        
        @media (max-width: 768px) {
            .game-area {
                height: 400px;
            }
            
            .ruler {
                width: 60px;
                height: 280px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
    <div class="game-section">
        <!-- å£°éŸ³æ§åˆ¶ -->
        <button class="sound-toggle" id="soundToggle">ğŸ”Š</button>
        
        <div class="game-container">
            <h1>å°ºå­æ‰ä¸‹æ¥</h1>
            <p class="description">å°ºå­ä¸€å‡ºç°å°±ç«‹å³ç‚¹å‡»å±å¹•ï¼Œè®©å°ºå­é™æ­¢ï¼Œæµ‹è¯•ä½ çš„ååº”é€Ÿåº¦ï¼</p>
            
            <div class="game-area" id="gameArea">
                <div class="ruler" id="ruler">
                    <!-- å°ºå­åˆ»åº¦å°†é€šè¿‡JSç”Ÿæˆ -->
                </div>
                <div class="click-indicator" id="clickIndicator"></div>
                <div class="hand" id="hand">ç‚¹å‡»åŒºåŸŸ</div>
            </div>
            
            <div class="result" id="result">å‡†å¤‡å¼€å§‹</div>
            <div class="next-instruction" id="nextInstruction"></div>
            
            <div class="controls">
                <button id="startBtn">å¼€å§‹æµ‹è¯•</button>
                <button id="resetBtn">é‡ç½®è®°å½•</button>
            </div>
        </div>
    </div>
    
    <!-- å³ä¾§ä¿¡æ¯åŒºåŸŸ -->
    <div class="info-section">
        <div class="score-display">
            <div class="score-item">
                <div class="score-value" id="bestLength">--</div>
                <div class="score-label">æœ€çŸ­é•¿åº¦</div>
            </div>
            <div class="score-item">
                <div class="score-value" id="lastLength">--</div>
                <div class="score-label">ä¸Šæ¬¡é•¿åº¦</div>
            </div>
            <div class="score-item">
                <div class="score-value" id="attempts">0/10</div>
                <div class="score-label">æµ‹è¯•è¿›åº¦</div>
            </div>
        </div>
        
        <div class="history-container">
            <div class="history-title">æµ‹è¯•è®°å½•</div>
            <div class="history-list" id="historyList">
                <!-- å†å²è®°å½•å°†é€šè¿‡JSç”Ÿæˆ -->
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="avgLength">--</div>
                    <div class="stat-label">å¹³å‡é•¿åº¦</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="minLength">--</div>
                    <div class="stat-label">æœ€çŸ­é•¿åº¦</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="maxLength">--</div>
                    <div class="stat-label">æœ€é•¿é•¿åº¦</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const gameArea = document.getElementById('gameArea');
            const ruler = document.getElementById('ruler');
            const hand = document.getElementById('hand');
            const result = document.getElementById('result');
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const bestLengthEl = document.getElementById('bestLength');
            const lastLengthEl = document.getElementById('lastLength');
            const attemptsEl = document.getElementById('attempts');
            const historyList = document.getElementById('historyList');
            const avgLengthEl = document.getElementById('avgLength');
            const minLengthEl = document.getElementById('minLength');
            const maxLengthEl = document.getElementById('maxLength');
            const nextInstruction = document.getElementById('nextInstruction');
            const clickIndicator = document.getElementById('clickIndicator');
            const soundToggle = document.getElementById('soundToggle');
            
            // æ¸¸æˆçŠ¶æ€å˜é‡
            let gameStarted = false;
            let waitingForSecondClick = false;
            let startTime = 0;
            let reactionTime = 0;
            let rulerLength = 0;
            let bestLength = localStorage.getItem('bestRulerLength') || Infinity;
            let lastLength = localStorage.getItem('lastRulerLength') || '--';
            let attempts = parseInt(localStorage.getItem('reactionAttempts')) || 0;
            let history = JSON.parse(localStorage.getItem('reactionHistory')) || [];
            let animationFrameId = null;
            let rulerPosition = -370;
            let soundEnabled = true;
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            updateDisplay();
            
            // ç”Ÿæˆå°ºå­åˆ»åº¦ï¼ˆæ•°å­—å¯¹è°ƒï¼šæœ€ä¸‹æ–¹æ˜¯0ï¼Œæœ€ä¸Šæ–¹æ˜¯30ï¼‰
            function createRulerMarks() {
                ruler.innerHTML = '';
                for (let i = 0; i <= 30; i++) {
                    const mark = document.createElement('div');
                    mark.className = i % 5 === 0 ? 'ruler-mark long' : 'ruler-mark';
                    ruler.appendChild(mark);
                    
                    if (i % 5 === 0) {
                        const number = document.createElement('div');
                        number.className = 'ruler-number';
                        // æ•°å­—å¯¹è°ƒï¼šæœ€ä¸‹æ–¹æ˜¯0ï¼Œæœ€ä¸Šæ–¹æ˜¯30
                        number.textContent = 30 - i;
                        ruler.appendChild(number);
                    }
                }
            }
            
            // åˆå§‹åŒ–å°ºå­
            createRulerMarks();
            
            // å¼€å§‹æ¸¸æˆ
            startBtn.addEventListener('click', startGame);
            
            // é‡ç½®è®°å½•
            resetBtn.addEventListener('click', resetHistory);
            
            // ç‚¹å‡»æ¸¸æˆåŒºåŸŸ
            gameArea.addEventListener('click', handleClick);
            
            // å£°éŸ³æ§åˆ¶
            soundToggle.addEventListener('click', toggleSound);
            
            // å¼€å§‹æ¸¸æˆå‡½æ•°
            function startGame() {
                if (gameStarted) return;
                
                gameStarted = true;
                waitingForSecondClick = false;
                result.textContent = "å‡†å¤‡...";
                nextInstruction.textContent = "";
                hand.classList.remove('success');
                hand.textContent = "å‡†å¤‡ç‚¹å‡»";
                clickIndicator.classList.remove('show');
                
                // é‡ç½®å°ºå­ä½ç½®
                rulerPosition = -370;
                ruler.style.top = rulerPosition + 'px';
                ruler.style.display = 'flex';
                
                // æ¸…é™¤ä¹‹å‰çš„åŠ¨ç”»
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
                
                // éšæœºå»¶è¿Ÿåå¼€å§‹æ‰è½
                const delay = Math.random() * 2000 + 1000; // 1-3ç§’éšæœºå»¶è¿Ÿ
                
                setTimeout(() => {
                    if (!gameStarted) return;
                    
                    result.textContent = "ç‚¹å‡»ï¼";
                    startTime = Date.now();
                    
                    // æ’­æ”¾æ‰è½éŸ³æ•ˆ
                    if (soundEnabled) playFallSound();
                    
                    // ä½¿ç”¨requestAnimationFrameå®ç°åŠ¨ç”»ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶
                    startRulerAnimation();
                    
                }, delay);
            }
            
            // ä½¿ç”¨requestAnimationFrameå®ç°å°ºå­åŠ¨ç”»
            function startRulerAnimation() {
                const animationStartTime = Date.now();
                const duration = 1500; // 1.5ç§’
                const startPosition = -370;
                const endPosition = 50;
                
                function animate() {
                    if (!gameStarted) return;
                    
                    const elapsed = Date.now() - animationStartTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    rulerPosition = startPosition + (endPosition - startPosition) * progress;
                    ruler.style.top = rulerPosition + 'px';
                    
                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(animate);
                    }
                }
                
                animationFrameId = requestAnimationFrame(animate);
            }
            
            // å¤„ç†ç‚¹å‡»äº‹ä»¶
            function handleClick() {
                if (!gameStarted && !waitingForSecondClick) return;
                
                if (gameStarted && !waitingForSecondClick) {
                    // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼šåœæ­¢å°ºå­åŠ¨ç”»ï¼Œè®¡ç®—ååº”æ—¶é—´
                    cancelAnimationFrame(animationFrameId);
                    
                    // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                    if (soundEnabled) playClickSound();
                    
                    // æ˜¾ç¤ºç‚¹å‡»ä½ç½®æŒ‡ç¤ºçº¿
                    clickIndicator.style.top = rulerPosition + 'px';
                    clickIndicator.classList.add('show');
                    
                    // è®¡ç®—ååº”æ—¶é—´å’Œå°ºå­éœ²å‡ºé•¿åº¦
                    reactionTime = Date.now() - startTime;
                    // è®¡ç®—å°ºå­éœ²å‡ºé•¿åº¦ï¼ˆå˜ç±³ï¼‰
                    // å°ºå­æ€»é•¿åº¦350pxï¼Œä»-370pxå¼€å§‹ï¼Œåˆ°50pxç»“æŸ
                    // éœ²å‡ºé•¿åº¦ = (å½“å‰topå€¼ + 370) / (370 + 50) * 30cm
                    const totalTravel = 370 + 50; // 420px
                    const currentTravel = rulerPosition + 370; // ä»0åˆ°420
                    rulerLength = Math.round((currentTravel / totalTravel) * 30);
                    
                    endGame();
                } else if (waitingForSecondClick) {
                    // ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼šå°ºå­æ¶ˆå¤±ï¼Œå¼€å§‹ä¸‹ä¸€æ¬¡æ¸¸æˆ
                    ruler.style.display = 'none';
                    clickIndicator.classList.remove('show');
                    waitingForSecondClick = false;
                    nextInstruction.textContent = "";
                    
                    // å¦‚æœè¿˜æ²¡å®Œæˆ10æ¬¡æµ‹è¯•ï¼Œè‡ªåŠ¨å¼€å§‹ä¸‹ä¸€æ¬¡
                    if (attempts < 10) {
                        setTimeout(() => {
                            startGame();
                        }, 500);
                    }
                }
            }
            
            // ç»“æŸæ¸¸æˆ
            function endGame() {
                gameStarted = false;
                waitingForSecondClick = true;
                
                // æ›´æ–°è®°å½•
                attempts++;
                lastLength = rulerLength;
                
                if (rulerLength < bestLength) {
                    bestLength = rulerLength;
                }
                
                // æ·»åŠ åˆ°å†å²è®°å½•ï¼ˆæœ€å¤š10æ¡ï¼‰
                history.unshift({
                    time: reactionTime,
                    length: rulerLength
                });
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('bestRulerLength', bestLength);
                localStorage.setItem('lastRulerLength', lastLength);
                localStorage.setItem('reactionAttempts', attempts);
                localStorage.setItem('reactionHistory', JSON.stringify(history));
                
                // æ›´æ–°æ˜¾ç¤º
                updateDisplay();
                
                // æ˜¾ç¤ºç»“æœ
                result.textContent = `ååº”æ—¶é—´: ${reactionTime} æ¯«ç§’ | å°ºå­éœ²å‡º: ${rulerLength}cm`;
                result.classList.add('pulse');
                hand.classList.add('success');
                hand.textContent = "æˆåŠŸï¼ç‚¹å‡»å±å¹•ç»§ç»­";
                nextInstruction.textContent = "å†æ¬¡ç‚¹å‡»å±å¹•å¼€å§‹ä¸‹ä¸€æ¬¡æµ‹è¯•";
                
                // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                if (soundEnabled) playSuccessSound();
                
                // ç§»é™¤è„‰å†²åŠ¨ç”»
                setTimeout(() => {
                    result.classList.remove('pulse');
                }, 500);
            }
            
            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            function playClickSound() {
                try {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 100);
                } catch (err) {
                    console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", err);
                }
            }
            
            // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
            function playSuccessSound() {
                try {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.frequency.value = 523.25; // C5
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    setTimeout(() => {
                        oscillator.frequency.value = 659.25; // E5
                    }, 100);
                    setTimeout(() => {
                        oscillator.frequency.value = 783.99; // G5
                    }, 200);
                    setTimeout(() => oscillator.stop(), 300);
                } catch (err) {
                    console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", err);
                }
            }
            
            // æ’­æ”¾æ‰è½éŸ³æ•ˆ
            function playFallSound() {
                try {
                    const context = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = context.createOscillator();
                    const gainNode = context.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(context.destination);
                    
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 300);
                } catch (err) {
                    console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", err);
                }
            }
            
            // åˆ‡æ¢å£°éŸ³
            function toggleSound() {
                soundEnabled = !soundEnabled;
                soundToggle.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”‡";
                soundToggle.style.background = soundEnabled ? 
                    "rgba(255, 255, 255, 0.8)" : "rgba(255, 107, 107, 0.8)";
            }
            
            // æ›´æ–°æ˜¾ç¤º
            function updateDisplay() {
                bestLengthEl.textContent = bestLength === Infinity ? '--' : bestLength + 'cm';
                lastLengthEl.textContent = lastLength === '--' ? '--' : lastLength + 'cm';
                attemptsEl.textContent = `${attempts}/10`;
                
                // æ›´æ–°å†å²è®°å½•
                updateHistory();
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateStats();
            }
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            function updateHistory() {
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<div style="color:#666;padding:10px;text-align:center;">æš‚æ— è®°å½•</div>';
                    return;
                }
                
                // æ˜¾ç¤ºå…¨éƒ¨è®°å½•
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    // æ ¹æ®é•¿åº¦è®¾ç½®ä¸åŒé¢œè‰²ï¼ˆè¶ŠçŸ­è¶Šå¥½ï¼‰
                    if (item.length < 10) {
                        historyItem.classList.add('good');
                    } else if (item.length < 20) {
                        historyItem.classList.add('average');
                    } else {
                        historyItem.classList.add('poor');
                    }
                    
                    const timeElement = document.createElement('div');
                    timeElement.className = 'history-time';
                    timeElement.textContent = `${item.time}ms`;
                    
                    const lengthElement = document.createElement('div');
                    lengthElement.className = 'history-length';
                    lengthElement.textContent = `éœ²å‡º${item.length}cm`;
                    
                    historyItem.appendChild(timeElement);
                    historyItem.appendChild(lengthElement);
                    historyList.appendChild(historyItem);
                });
            }
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            function updateStats() {
                if (history.length === 0) {
                    avgLengthEl.textContent = '--';
                    minLengthEl.textContent = '--';
                    maxLengthEl.textContent = '--';
                    return;
                }
                
                const lengths = history.map(item => item.length);
                const sum = lengths.reduce((a, b) => a + b, 0);
                const avg = Math.round(sum / history.length);
                const min = Math.min(...lengths);
                const max = Math.max(...lengths);
                
                avgLengthEl.textContent = avg + 'cm';
                minLengthEl.textContent = min + 'cm';
                maxLengthEl.textContent = max + 'cm';
            }
            
            // é‡ç½®å†å²è®°å½•
            function resetHistory() {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®°å½•å—ï¼Ÿ')) {
                    attempts = 0;
                    bestLength = Infinity;
                    lastLength = '--';
                    history = [];
                    gameStarted = false;
                    waitingForSecondClick = false;
                    
                    localStorage.removeItem('bestRulerLength');
                    localStorage.removeItem('lastRulerLength');
                    localStorage.removeItem('reactionAttempts');
                    localStorage.removeItem('reactionHistory');
                    
                    updateDisplay();
                    result.textContent = "è®°å½•å·²é‡ç½®";
                    nextInstruction.textContent = "";
                    hand.classList.remove('success');
                    hand.textContent = "ç‚¹å‡»åŒºåŸŸ";
                    clickIndicator.classList.remove('show');
                    
                    // é‡ç½®å°ºå­ä½ç½®
                    rulerPosition = -370;
                    ruler.style.top = rulerPosition + 'px';
                    ruler.style.display = 'flex';
                    
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                }
            }
        });
    </script>
</body>
</html>